---
title: "Beach BIA Biodiversity BIA"
author: "Derek Li"
date: "2025-09-29"
output: html_document
---

```{r setup, include=FALSE}
knitr::opts_chunk$set(echo = TRUE)
```

```{r file-overview, include=FALSE}
# Purpose: Visualize Beach BIA / Woodbine Beach polygons with iNaturalist observations and Toronto tree points (interactive leaflet maps).
# Inputs : BIA shapefile, WoodbineBeach shapefile, TOPO_TREE_WGS84, and iNaturalist CSV (paths based on a /data folder layout).
# Outputs: Interactive maps in the knitted HTML.
# Notes  : Assumes a /code vs /data directory structure; update `data.dir` if your local layout differs.
# Author : Derek Li (comments/formatting added by Peter)
```


## R Markdown

```{r}
library(sf)
library(leaflet)
library(dplyr)
```

```{r}
# NOTE: This notebook assumes a /code vs /data folder layout.
# If your working directory differs, update `data.dir` accordingly.

data.dir <- gsub('/code', '/data', getwd())

# --- Read input datasets ---
# BIA polygons, Woodbine Beach polygon, tree points, and iNaturalist observations.
BIA_data <- st_read(paste0(data.dir, "/data/BIAshapes/Business Improvement Areas Data - 4326.shp"))

beach_park <- st_read(paste0(data.dir, "/data/beach_shapes/WoodbineBeach.shp"))

trees <- st_read(paste0(data.dir, "/data/trees/TOPO_TREE_WGS84.shp"))

inaturalist_df <- read.csv(paste0(data.dir, "/data/inaturalist/observations.csv"))
```


```{r}
# --- Define area of interest (AOI) ---
# Keep only the 'The Beach' BIA polygon, then convert iNaturalist points to sf for mapping.
beach_bia <- BIA_data %>% filter(AREA_NA8 == "The Beach")

# Converting data from iNaturalist into sf
inaturalist_df <- inaturalist_df %>%
  mutate(
    lon = as.numeric(longitude),
    lat = as.numeric(latitude)
  ) %>%
  filter(!is.na(longitude),
         !is.na(latitude),
         lon >= -180,
         lon <= 180,
         lat >= -90,
         lat <= 90)

obs_sf <- st_as_sf(inaturalist_df, coords = c("longitude", "latitude"), crs = 4326)
```


```{r}
# Displaying trees on the map
leaflet() %>% addProviderTiles("CartoDB.Positron") %>%
  addCircles(data = trees,
             opacity = 1,
             radius = 1)
```


```{r}
# Displaying all the shapes
leaflet() %>% addProviderTiles("CartoDB.Positron") %>% 
  addPolygons(data = beach_bia,
              label = ~AREA_NA8,
              fillOpacity = 0.1,
              weight = 2) %>% 
  addPolygons(data = beach_park,
              label = "Woodbine Beach/Park",
              fillColor = "pink",
              color = "red",
              weight = 2) %>% 
  addCircleMarkers(data = obs_sf,
                   label = ~scientific_name,
                   color = "blue",
                   opacity = 1,
                   radius = 1) %>% 
  addCircleMarkers(data = trees,
                   color = "green",
                   opacity = 1,
                   radius = 1)
```


```{r}
# --- Spatial filtering ---
# Keep only iNaturalist observations and trees that fall within the union of
# (Beach BIA polygon) âˆª (Woodbine Beach/Park polygon).
polys <- bind_rows(beach_bia, beach_park)
obs_within <- st_filter(obs_sf, polys, .predicate = st_within)

# Only interested in trees within areas of interest
trees_within <- st_filter(trees, polys, .predicate = st_within)
```


```{r}
# Mapping everything together
leaflet() %>% addProviderTiles("CartoDB.Positron") %>% 
  addPolygons(data = beach_bia,
              group = "BIA street",
              label = ~AREA_NA8,
              fillOpacity = 0.1,
              weight = 2) %>% 
  addPolygons(data = beach_park,
              label = "Woodbine Beach/Park",
              group = "Park/Beach",
              fillColor = "red",
              color = "red",
              weight = 2) %>% 
  addCircles(data = obs_within,
             group = "iNaturalist",
             color = "blue",
             label = ~scientific_name,
             opacity = 1,
             radius = 1,
             weight = 4) %>% 
  addCircles(data = trees_within,
             group = "Trees",
             color = "green",
             opacity = 1,
             radius = 1,
             weight = 4) %>% 
  addLegend(position = "bottomright",
            colors = c("blue", "green"),
            labels = c("iNaturalist Observations", "Trees"),
            title = "Legend",
            opacity = 1) %>% 
  addLayersControl(position = "topright",
                   overlayGroups = c("Trees", "iNaturalist",
                                     "BIA street", "Park/Beach"),
                   options = layersControlOptions(collapsed = FALSE))
```

